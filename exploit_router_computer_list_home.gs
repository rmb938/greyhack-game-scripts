#import ScanVulns from libs/scanvulns.gs;

metax = include_lib("/lib/metaxploit.so")
if not metax then 
  metax = include_lib(current_path + "/metaxploit.so")
end if

if not metax then 
  exit("Error: Missing metaxploit library")
end if

if params.len != 1 or params[0] == "-h" or params[0] == "--help" then exit("<b>Usage: exploit_router_computer_list_home [ip address]</b>")

routerIP = params[0]
routerNetSession = metax.net_use(routerIP, 0)
kernel_router = routerNetSession.dump_lib
print("kernel_router.so: "+kernel_router.version)

exploits = ScanVulns(kernel_router)

lanIp = user_input("Enter a LAN address: ")

for exploit in exploits
  if (exploit.hasRequirement == true) then
    continue
  end if
  overflow = kernel_router.overflow(exploit.address, exploit.name, lanIp)
  if (typeof(overflow) != "computer") then
    continue
  end if

  print("Found computer on address "+exploit.address+" Name: "+exploit.name)
  
  homeDirs = overflow.File("/home")

  for homeDir in homeDirs.get_folders()
      print ("Home Dir: "+homeDir.path)
  end for

  exit()
end for

exit("No computer exploits found")
