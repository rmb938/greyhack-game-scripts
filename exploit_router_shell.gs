#import ScanVulns from libs/scanvulns.gs;

metax = include_lib("/lib/metaxploit.so")
if not metax then 
  metax = include_lib(current_path + "/metaxploit.so")
end if

if not metax then 
  exit("Error: Missing metaxploit library")
end if

if params.len != 1 or params[0] == "-h" or params[0] == "--help" then exit("<b>Usage: exploit_router_shell [ip address]</b>")

routerIP = params[0]
routerNetSession = metax.net_use(routerIP, 0)
kernel_router = routerNetSession.dump_lib
print("kernel_router.so: "+kernel_router.version)

exploits = ScanVulns(kernel_router)

for exploit in exploits
  if (exploit.hasRequirement == true) then
    continue
  end if
  overflow = kernel_router.overflow(exploit.address, exploit.name)
  if (typeof(overflow) != "shell") then
    continue
  end if

  print("Found shell on address "+exploit.address+" Name: "+exploit.name)
  overflow.start_terminal()
  exit()
end for

exit("No shell exploits found")
